---
title: "Assignment 3"
format:
  html:
    code-fold: false
    embed-resources: true
    toc: true
---

# Dataset Description: U.S. Bilateral Trade in Poultry Products  

This dataset contains bilateral international trade data for the United States as the reporter country, focusing on the commodity classified under "**meat and edible offal**" of poultry, traded in fresh, chilled, or frozen form.  

The dataset includes poultry products, covering common cuts and parts such as breasts, thighs, wings, livers, hearts, and gizzards. It excludes live poultry and processed poultry products.  

Trade flows are reported with all countries as partners, meaning the data capture U.S. poultry trade with every trading partner (countries) worldwide. The dataset includes:  

-   Imports: Poultry products entering the United States from foreign suppliers (e.g., frozen chicken from Brazil or Canada).  

-   Exports: Poultry products shipped from the United States to international markets (e.g., U.S. poultry exports to Mexico or Asian countries).  

The data are aggregated at an annual frequency and cover the period 2018â€“2025.  

# Data Source:  

The dataset is obtained from the UN Comtrade database, an open-access repository of official international trade statistics compiled from customs data reported by over 150 countries. Key variables include trade values (USD) and quantities (kilograms), reflecting officially reported bilateral trade flows between the United States and its trading partners.  

# General directions  

1.  For each question, you are encouraged to create a chunk below it, and fully develop the code that creates your answer.  

2.  You are encouraged to use wrangling functions from the packages `dplyr` and `tidyr`, and plotting functions from the package `ggplot2`.  

3.  You are encouraged to the the pipe operator (`%>%` or `|>`) to pipe wrangling steps together.  

4.  For each question, after showing your code and output (be it numerical or graphical), you also need to provide a written sentence of your answer. Just showing code output is not sufficient for full points.  

5.  As part of the initial wrangling, you are expected to:  

-   Transform the `qty` column from kg to Mg  
-   Select only columns that are useful to answer the questions.  

6. Check out the following cheatsheets to give you some ideas on wrangling and plotting:  

  - **ggplot2**: https://posit.co/wp-content/uploads/2022/10/data-visualization-1.pdf  
  - **dplyr**: https://rstudio.github.io/cheatsheets/data-transformation.pdf   
  


## Dataset

```{r}

library(readxl) # to read excel files
library(janitor) # to clean data
library(dplyr) # wrangling
library(tidyr) # wrangling
library(readr) # to export csv
library(ggplot2)
```

```{r}

chicken <- read_csv("03_assignment_data.csv")

# Checking first rows
chicken


glimpse(chicken)

```

```{r Summary}
summary(chicken)
```


# Assignemnt Questions:

## Imports:

#### 1. How many distinct countries were there (based on given data), from where US was importing the poultry products from 2018-2024?

```{r Clean}
chicken_import <- clean_names(chicken)
chicken_import <- filter(chicken_import, flow_desc == "Import")
chicken_import

```
```{r}
#count unique values in partner column
unique_countries <- n_distinct(chicken_import$partner_desc)
unique_countries
```


```{r}

```
##### ***There were 7 unique countries the U.S. was importing from during the 2018-2024 period.***

#### 2. What are the minimum, maximum trade values for imports? Mention the country, year and its respective value.
```{r}
#mutate import qty from kg to Mg
import_01 <- mutate(chicken_import,
                  qty_mg = qty*1000000,
                  qty_mg= round(qty_mg, 0)
                  )
import_01
```


```{r}
#summarize for mean, minimum, maximum, etc. 
import_sum <- select(import_01, ref_year, period, flow_desc,
 partner_desc, qty_unit_abbr, qty, primary_value, qty_mg
)  
import_sum


import_sort <- arrange(import_sum, primary_value)
import_sort

```
#####***The minimum value for trade imports came from Poland in 2022 at 4308 (primary value based on FOB or CIF). The maximum value came from Chile in 2022 at 428214676 primary value.***

#### 3. Identify the top 5 countries from which the USA imported the most (qty) in the years 2018 and 2024. List the countries and their corresponding import values.
```{r}
### Piping it all together
import_2018 <- chicken %>%
  clean_names() %>%
  filter(flow_desc == "Import") %>%
  filter(ref_year == "2018") %>%
  mutate(qty_mg = qty*1000000,
                  qty_mg= round(qty_mg, 0) )%>%
 dplyr::select(ref_year, period, flow_desc,
 partner_desc, qty_unit_abbr, qty, primary_value, qty_mg
 )%>%
  
  arrange(
                  qty_mg
                  )


import_2018
```

####***For 2018, there were only four countries with top imported values included Germany at 6.605300e+10 mg, Israel at 1.693018e+12 mg,Canada at 3.158220e+13 mg, and Chile at 4.020218e+13 mg.***


```{r}
###Piping it all together
import_2024 <- chicken %>%
  clean_names() %>%
  filter(flow_desc == "Import") %>%
  filter(ref_year == "2024") %>%
  mutate(qty_mg = qty*1000000,
                  qty_mg= round(qty_mg, 0) )%>%
 dplyr::select(ref_year, period, flow_desc,
 partner_desc, qty_unit_abbr, qty, primary_value, qty_mg
)%>%
  
  arrange(
                  qty_mg
                  )


import_2024

```

####***For 2024, there were only three import countries with the top values being 1.871200e+11 mg for Mexico, 3.179255e+13 mg for Canada, and 5.530901e+13 mg for Chile.***

#### 4. Calculate the total import value for the USA from each country. Which country had the highest total export value **to** US, and what was that value?
```{r}
###Sum Imports Per Country
import_total <- chicken %>%
  clean_names() %>%
  filter(flow_desc == "Import") %>%
  mutate(qty_mg = qty*1000000,
                  qty_mg= round(qty_mg, 0) )%>%
 dplyr::select(ref_year, period, flow_desc,
 partner_desc, qty_unit_abbr, qty, primary_value, qty_mg
)%>%

group_by(partner_desc) %>%
summarize(sum_value = sum(primary_value))%>%
arrange(1/sum_value)

import_total


```
####***The country with the largest sum export value to the US was Chile, at a primary value of 1532686723.***


#### 5. Calculate the total import value for the USA in each year from 2018 to 2025. Which year had the highest total import value, and what was that value?
```{r}
###Sum Imports Per YEAR
import_total <- chicken %>%
  clean_names() %>%
  filter(flow_desc == "Import") %>%
  mutate(qty_mg = qty*1000000,
                  qty_mg= round(qty_mg, 0) )%>%
 dplyr::select(ref_year, period, flow_desc,
 partner_desc, qty_unit_abbr, qty, primary_value, qty_mg
)%>%

group_by(ref_year) %>%
summarize(sum_value = sum(primary_value))%>%
arrange(1/sum_value)

import_total

```
####***The year with the highest total import value was 2022 with a primary value of 566412591.***


#### 6. Plot a line graph showing the total annual import value for the USA from 2018 to 2024. Describe any noticeable trends or patterns (e.g., increases, decreases, or fluctuations) in the graph. Create a publication ready plot.
```{r}
###Total Annual Import Value, USA 2018-2024



ggplot(import_total, aes(x = ref_year, y = sum_value))+
  geom_line()+
labs(
    x = "Import Year",
    y = "Total Import Value",
    title = "Total Import Value by Year"
  )+ 
  theme_dark()


```
####***The figure above shows total import values by year for the US.We can see a noticeable trend from 2020 through 2022 were total import values dramatically rose, then tanked within a year as 2023 settled in. ***
## Exports:

#### 7. How many distinct countries were there (based on given data), to where US was exporting the poultry products?
```{r}
chicken_export <- chicken %>%
clean_names() %>%
filter(flow_desc == "Export")%>%
mutate(qty_mg = qty*1000000,
                  qty_mg= round(qty_mg, 0) )%>%
 dplyr::select(ref_year, period, flow_desc,
 partner_desc, qty_unit_abbr, qty, primary_value, qty_mg
)

chicken_export

```


```{r}
#count unique values in partner column
unique_countries <- n_distinct(chicken_export$partner_desc)
unique_countries
```
#####***There were 188 distinct countries that the U.S. was exporting to between 2018-2025. ***


#### 8. What are the minimum, maximum trade values for exports? Mention the country, year and its respective value.
```{r}
#summarize for mean, minimum, maximum, etc. 
chicken_export <- chicken %>%
clean_names() %>%
filter(flow_desc == "Export")%>%
mutate(qty_mg = qty*1000000,
                  qty_mg= round(qty_mg, 0) )%>%
 dplyr::select(ref_year, period, flow_desc,
 partner_desc, qty_unit_abbr, qty, primary_value, qty_mg
) %>%
arrange(primary_value)

chicken_export



```
#####***The minimum observed trade export value (primary value) was 2900 from Czechia in 2018, while the highest was 125665699 observed as the primary value from Viet Nam in 2022. ***


#### 9. Identify the top 5 countries to which the USA exported the most (qty) in the years 2018 and 2024. List the countries and their corresponding export values.
```{r}
###Piping it all together
export_2018 <- chicken %>%
  clean_names() %>%
  filter(flow_desc == "Export") %>%
  filter(ref_year == "2018") %>%
  mutate(qty_mg = qty*1000000,
                  qty_mg= round(qty_mg, 0) )%>%
 dplyr::select(ref_year, period, flow_desc,
 partner_desc, qty_unit_abbr, qty, primary_value, qty_mg
)%>%
  
  arrange(
                  qty_mg
                  )


export_2018

```
#####***In 2018, the country with the largest export quantity was Mexico at 7.928131e+14 mg, followed by China, Hong Kong SAR at 2.917131e+14 mg, Other Asia at 2.093894e+14 mg, Cuba at 2.024927e+14 mg, and Canada at 1.952350e+14 mg . ***

```{r}
###Piping it all together

export_2024 <- chicken %>%
  clean_names() %>%
  filter(flow_desc == "Export") %>%
  filter(ref_year == "2024") %>%
  mutate(qty_mg = qty*1000000,
                  qty_mg= round(qty_mg, 0) )%>%
 dplyr::select(ref_year, period, flow_desc,
 partner_desc, qty_mg, qty_unit_abbr, qty, primary_value
)%>%
  
  arrange(
                  1/qty_mg
                  )


export_2024


```

#####***In 2024, the 5 countries with the largest export quantities in mg were Mexico at 8.529040e+14 mg, followed by Cuba at 2.396432e+14	mg, Other Asia at 2.100486e+14 mg, Philippines at 1.630840e+14 mg, and Canada at 1.481891e+14	mg. ***


#### 10. Calculate the total export value for the USA from each country. Which country had the highest total import value **from** US, and what was that value?
```{r}
###Sum Exports Per Country
export_total <- chicken %>%
  clean_names() %>%
  filter(flow_desc == "Export") %>%
  mutate(qty_mg = qty*1000000,
                  qty_mg= round(qty_mg, 0) )%>%
 dplyr::select(ref_year, period, flow_desc,
 partner_desc, qty_mg, qty_unit_abbr, qty, primary_value
)%>%

group_by(partner_desc) %>%
summarize(sum_value = sum(primary_value))%>%
arrange(1/sum_value)

export_total
```

#####***The country with the highest import value, or value exported from the US, was Mexico with a total primary trade value of 6823047519. ***

#### 11. Calculate the total export value for the USA in each year from 2018 to 2025. Which year had the highest total export value, and what was that value?
```{r}
###Sum Exports Per Year
export_total <- chicken %>%
  clean_names() %>%
  filter(flow_desc == "Export") %>%
  mutate(qty_mg = qty*1000000,
                  qty_mg= round(qty_mg, 0) )%>%
 dplyr::select(ref_year, period, flow_desc,
 partner_desc, qty_mg, qty_unit_abbr, qty, primary_value
)%>%

group_by(ref_year) %>%
summarize(sum_value = sum(primary_value))%>%
arrange(1/sum_value)

export_total

```
#####***The highest net export value was observed for 2022, totaling at 5401343250 for the primary trade value. ***


#### 12. Plot a line graph showing the total annual export value for the USA from 2018 to 2024. Describe any noticeable trends or patterns (e.g., increases, decreases, or fluctuations) in the graph. Create a publication ready plot.
```{r}
###Total Annual Import Value, USA 2018-2024



ggplot(export_total, aes(x = ref_year, y = sum_value))+
  geom_line()+
labs(
    x = "Export Year",
    y = "Total Export Value",
    title = "Total Export Value by Year"
  )+ 
  theme_minimal()

```
####***The above figure shows total export values by year for the U.S., with a clear increase and change in the trend being observed starting in 2020 and going through 2022, where a peak total export value is reached before a less dramatic decline in total export value begins from 2022 going into 2023 and continuing onward.***

## Imports - Exports Comparision:

#### 13. Does the U.S. behave more as a net importer or net exporter for this commodity? Explore it:

-   Based on total value US imports and exports.
-   Based on number of countries US imports and exports
-   Based on each year's import export value.
```{r}
###Sum Per Export/Import
chicken_total <- chicken %>%
  clean_names() %>%
  mutate(qty_mg = qty*1000000,
                  qty_mg= round(qty_mg, 0) )%>%
 dplyr::select(ref_year, period, flow_desc,
 partner_desc, qty_mg, qty_unit_abbr, qty, primary_value
)%>%

group_by(flow_desc) %>%
summarize(sum_value = sum(primary_value))%>%
arrange(1/sum_value)

chicken_total
```
```{r}
###Sum Per Export/Import
chicken_total <- chicken %>%
  clean_names() %>%
  mutate(qty_mg = qty*1000000,
                  qty_mg= round(qty_mg, 0) )%>%
 dplyr::select(ref_year, period, flow_desc,
 partner_desc, qty_mg, qty_unit_abbr, qty, primary_value
)%>%

group_by(flow_desc, ref_year) %>%
summarize(sum_value = sum(primary_value))%>%
arrange(1/sum_value)

chicken_total
```
#####***Given that a sum trade value of 31042194412 was observed for all exports compared to only 2427597118 for all historic US imports, and given that the highest two export/import values observed per year were both for exports in 2022 and 2023, it is fair to say the U.S. is primarily in the chicken export market as a net exporter. This is further supported by the fact that they have 188 countries they export to compared to only  7 countries for imports. ***

#### 14. Are the main import partners also major export destinations? Explore it based on the total import export value by countries.

```{r}
###Sum Per Export/Import
chicken_country <- chicken %>%
  clean_names() %>%
  mutate(qty_mg = qty*1000000,
                  qty_mg= round(qty_mg, 0) )%>%
 dplyr::select(ref_year, period, flow_desc,
 partner_desc, qty_mg, qty_unit_abbr, qty, primary_value
)%>%

group_by(flow_desc, partner_desc) %>%
summarize(sum_value = sum(primary_value))%>%
arrange(1/sum_value)

chicken_country
```
```{r}
###Sum Per Export/Import
chicken_imp <- chicken %>%
  clean_names() %>%
  filter(flow_desc == "Import") %>%
  mutate(qty_mg = qty*1000000,
                  qty_mg= round(qty_mg, 0) )%>%
 dplyr::select(ref_year, period, flow_desc,
 partner_desc, qty_mg, qty_unit_abbr, qty, primary_value
)%>%

group_by(partner_desc) %>%
summarize(sum_value = sum(primary_value))%>%
arrange(1/sum_value)

chicken_imp
```
```{r}
###Sum Per Export/Import
chicken_imp <- chicken %>%
  clean_names() %>%
  filter(flow_desc == "Export") %>%
  mutate(qty_mg = qty*1000000,
                  qty_mg= round(qty_mg, 0) )%>%
 dplyr::select(ref_year, period, flow_desc,
 partner_desc, qty_mg, qty_unit_abbr, qty, primary_value
)%>%

group_by(partner_desc) %>%
summarize(sum_value = sum(primary_value))%>%
arrange(1/sum_value)

chicken_imp
```

#####***The top highest value export countries include Mexico, China, Canada, Other Asia, and Cuba. The top highest value import countries include Chile, Canada, Israel, Mexico, and Germany.Therefore there is some overlap with the main import partners such as Canada and Mexico being major export partners, but that is only 2 out 5 for the top five import and export countries based on trade value, so it is not the majority of import partners.***

#### 15. Can you calculate if US is in trade surplus or trade deficit for each year from 2018-2024?



$$\text{Trade surplus or deficit} = \text{Imports} - \text{Exports}$$
```{r}

```

# Submitting your work  

Once you have developed all the code and answers, make sure to Render this quarto file.  

**Notes on rendering**:  

- Make sure to render your work and inspect how the final html look like.  
- If it does not look professional for whatever reason, then fix the issue, re-render it, recheck.  
- Only send me your work once your html file looks professional.  
- Some potential issues you may encounter and how to fix them:   
  - Some times your code may be creating a table output that is waaay to long and cumbersome to scroll through when rendered. If this is the case, make it more professional looking by using the `head()` function to only print the first handful of rows (instead of thousands of rows).  
  
  - **DO NOT** delete the file's heading levels (# and ##). They set up the proper heading 1 and 2 levels, and I use them to guide my grading.  
  
  - There's a total of **15 questions**. If you mess around with the heading levels and you get a different number of questions on the rendered version, fix it.  
  
  - If a given chunk is also outputting warnings or messages, inhibit this behavior by changing the chunk options `message` and `warning` to `FALSE` (I'll demo this in a moment).  
  
  - If, after rendered, 2 lines of text are connected and you wish to "break line" between them, add 2 extra spaces after the first one (I'lld demo this in a moment).    
  
After rendering, an .html file will be created on your `code` folder.  

Rename this file to `03_assignment_LASTNAME.html`.    

For ex., `03_assignment_Bastos.html`.

Submit the html file on eLC by Monday Feb 2nd 11:59 pm, **one week** from today.  

